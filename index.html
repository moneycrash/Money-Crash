<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartoon Cash Land - Spin & Earn</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4a6bff;
            --secondary: #ff6b9d;
            --accent: #ffcc00;
            --light: #f0f8ff;
            --dark: #333366;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Chalkboard SE', cursive;
        }

        body {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
            min-height: 100vh;
            color: var(--dark);
            overflow-x: hidden;
        }

        .cloud {
            position: absolute;
            background: white;
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
            z-index: -1;
            animation: float 20s infinite linear;
        }

        .cloud:nth-child(1) {
            width: 120px;
            height: 40px;
            top: 10%;
            left: 5%;
            animation-duration: 25s;
        }

        .cloud:nth-child(2) {
            width: 180px;
            height: 60px;
            top: 25%;
            right: 10%;
            animation-duration: 30s;
        }

        .cloud:nth-child(3) {
            width: 150px;
            height: 50px;
            bottom: 20%;
            left: 15%;
            animation-duration: 35s;
        }

        .rainbow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 0%, rgba(255,0,0,0.2) 0%, rgba(255,154,0,0.2) 10%, rgba(208,222,33,0.2) 20%, rgba(79,220,74,0.2) 30%, rgba(63,218,216,0.2) 40%, rgba(47,201,226,0.2) 50%, rgba(28,127,238,0.2) 60%, rgba(95,21,242,0.2) 70%, rgba(186,12,248,0.2) 80%, rgba(251,7,217,0.2) 90%, rgba(255,0,0,0.2) 100%);
            z-index: -1;
            opacity: 0.3;
        }

        .coin {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle at 30% 30%, #ffcc00, #ff9900);
            border-radius: 50%;
            box-shadow: 0 0 10px gold;
            z-index: -1;
            animation: fall 15s infinite linear;
        }

        .coin:nth-child(4) {
            left: 10%;
            animation-delay: 0s;
            animation-duration: 18s;
        }

        .coin:nth-child(5) {
            left: 30%;
            animation-delay: 2s;
            animation-duration: 20s;
        }

        .coin:nth-child(6) {
            left: 60%;
            animation-delay: 4s;
            animation-duration: 22s;
        }

        .coin:nth-child(7) {
            left: 80%;
            animation-delay: 6s;
            animation-duration: 24s;
        }

        @keyframes float {
            0% { transform: translateX(-100px); }
            100% { transform: translateX(calc(100vw + 100px)); }
        }

        @keyframes fall {
            0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 3px solid var(--accent);
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .logo i {
            margin-right: 10px;
            color: var(--accent);
        }

        .stats {
            display: flex;
            gap: 15px;
        }

        .stat {
            background: var(--light);
            padding: 8px 15px;
            border-radius: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.1);
        }

        .stat i {
            color: var(--primary);
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .wheel-container {
            position: relative;
            width: 300px;
            height: 300px;
            margin: 0 auto 30px;
        }

        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            border: 10px solid var(--accent);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
            transition: transform 4s cubic-bezier(0.2, 0.8, 0.3, 1);
            background: white;
        }

        .wheel-section {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: bottom right;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            border: 5px solid var(--accent);
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: var(--dark);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }

        .spin-button {
            display: block;
            width: 200px;
            margin: 0 auto;
            padding: 15px;
            background: linear-gradient(to bottom, var(--accent), #ff9900);
            border: none;
            border-radius: 50px;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2), 0 0 20px rgba(255, 204, 0, 0.5);
            transition: all 0.3s;
            text-align: center;
        }

        .spin-button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .spin-button:disabled {
            background: #cccccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        .ad-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .ad-placeholder {
            width: 100%;
            height: 100px;
            background: #f0f0f0;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #666;
            margin-bottom: 10px;
        }

        .win-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            z-index: 100;
            display: none;
            border: 5px solid var(--accent);
            animation: pop 0.5s;
        }

        @keyframes pop {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .win-amount {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--success);
            margin: 15px 0;
        }

        .close-popup {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .referral-container, .withdraw-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .info-box {
            background: var(--light);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary);
        }

        .referral-id {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .referral-link {
            display: flex;
            margin-bottom: 15px;
        }

        .referral-link input {
            flex: 1;
            padding: 10px;
            border: 2px solid var(--primary);
            border-radius: 10px 0 0 10px;
            font-size: 1rem;
        }

        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0 15px;
            border-radius: 0 10px 10px 0;
            cursor: pointer;
        }

        .bonus-info {
            background: linear-gradient(to right, var(--accent), #ff9900);
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
        }

        .withdraw-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 20px;
        }

        .withdraw-option {
            background: var(--light);
            padding: 15px;
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .withdraw-option:hover {
            border-color: var(--primary);
        }

        .withdraw-option i {
            font-size: 1.5rem;
            color: var(--primary);
        }

        .withdraw-option.active {
            background: var(--primary);
            color: white;
        }

        .withdraw-option.active i {
            color: white;
        }

        .withdraw-form {
            display: none;
            margin-top: 20px;
            background: var(--light);
            padding: 20px;
            border-radius: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1rem;
        }

        .form-group input:focus {
            border-color: var(--primary);
            outline: none;
        }

        .submit-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            width: 100%;
            transition: all 0.3s;
        }

        .submit-btn:hover {
            background: var(--dark);
        }

        .rate-info {
            background: var(--light);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .error-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: center;
            z-index: 100;
            display: none;
            border: 5px solid var(--danger);
            max-width: 90%;
            width: 400px;
        }

        .error-icon {
            font-size: 3rem;
            color: var(--danger);
            margin-bottom: 15px;
        }

        .error-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--danger);
        }

        .error-message {
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .close-error {
            background: var(--danger);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
            display: none;
        }

        .stage-info {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stage-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--primary);
            text-align: center;
        }

        .stage-details {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
        }

        .stage-item {
            text-align: center;
        }

        .stage-value {
            font-weight: bold;
            color: var(--success);
        }
    </style>
</head>
<body>
    <!-- Background elements -->
    <div class="cloud"></div>
    <div class="cloud"></div>
    <div class="cloud"></div>
    <div class="coin"></div>
    <div class="coin"></div>
    <div class="coin"></div>
    <div class="coin"></div>
    <div class="rainbow"></div>

    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-coins"></i>
                Cartoon Cash Land
            </div>
            <div class="stats">
                <div class="stat">
                    <i class="fas fa-wallet"></i>
                    <span id="balance">0৳</span>
                </div>
                <div class="stat">
                    <i class="fas fa-users"></i>
                    <span id="referrals">0</span>
                </div>
            </div>
        </header>

        <div class="tabs">
            <div class="tab active" data-tab="home">Home</div>
            <div class="tab" data-tab="refer">Refer</div>
            <div class="tab" data-tab="withdraw">Withdraw</div>
        </div>

        <!-- Home Tab -->
        <div class="tab-content active" id="home-tab">
            <div class="wheel-container">
                <div class="wheel" id="wheel">
                    <!-- Wheel sections will be generated by JavaScript -->
                </div>
                <div class="wheel-center">SPIN</div>
            </div>

            <button class="spin-button" id="spin-button">Tap to Spin</button>

            <div class="stage-info">
                <div class="stage-title">Current Stage: <span id="current-stage">1</span></div>
                <div class="stage-details">
                    <div class="stage-item">
                        <div>Spins Left</div>
                        <div class="stage-value" id="spins-left">10</div>
                    </div>
                    <div class="stage-item">
                        <div>Amount per Spin</div>
                        <div class="stage-value" id="amount-per-spin">10৳</div>
                    </div>
                    <div class="stage-item">
                        <div>Stage Total</div>
                        <div class="stage-value" id="stage-total">100৳</div>
                    </div>
                </div>
            </div>

            <div class="ad-container">
                <div class="ad-placeholder">
                    Ad will play after spin
                </div>
                <p>Watch an ad to spin the wheel</p>
            </div>
        </div>

        <!-- Refer Tab -->
        <div class="tab-content" id="refer-tab">
            <div class="referral-container">
                <div class="info-box">
                    <h3>Your Referral Information</h3>
                    <div class="referral-id">
                        <i class="fas fa-id-card"></i>
                        <span>Your Referral ID: <strong id="referral-id">SPIN12345</strong></span>
                    </div>
                    <div class="referral-link">
                        <input type="text" id="referral-link" value="http://t.me/money_crash0_bot?start=SPIN12345" readonly>
                        <button class="copy-btn" id="copy-btn">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="referral-count">
                        <i class="fas fa-user-plus"></i>
                        <span>People referred: <strong id="referral-count">0</strong></span>
                    </div>
                </div>

                <div class="bonus-info">
                    <i class="fas fa-gift"></i>
                    Refer 6 people to unlock withdraw feature!
                </div>
            </div>
        </div>

        <!-- Withdraw Tab -->
        <div class="tab-content" id="withdraw-tab">
            <div class="withdraw-container">
                <div class="info-box">
                    <h3>Withdraw Your Earnings</h3>
                    <p>Choose your preferred withdrawal method</p>
                </div>

                <div class="withdraw-options">
                    <div class="withdraw-option" data-option="bkash">
                        <i class="fas fa-mobile-alt"></i>
                        <div>
                            <div class="option-name">Bkash</div>
                            <div class="option-min">Minimum: 500৳</div>
                        </div>
                    </div>
                    <div class="withdraw-option" data-option="nagad">
                        <i class="fas fa-wallet"></i>
                        <div>
                            <div class="option-name">Nagad</div>
                            <div class="option-min">Minimum: 500৳</div>
                        </div>
                    </div>
                    <div class="withdraw-option" data-option="binance">
                        <i class="fas fa-coins"></i>
                        <div>
                            <div class="option-name">Binance (USDT)</div>
                            <div class="option-min">Minimum: $5</div>
                        </div>
                    </div>
                </div>

                <!-- Bkash Form -->
                <div class="withdraw-form" id="bkash-form">
                    <div class="form-group">
                        <label for="bkash-number">Bkash Number</label>
                        <input type="text" id="bkash-number" placeholder="01XXXXXXXXX">
                    </div>
                    <div class="form-group">
                        <label for="bkash-amount">Amount (৳)</label>
                        <input type="number" id="bkash-amount" placeholder="500" min="500">
                    </div>
                    <button class="submit-btn" id="bkash-submit">Withdraw</button>
                </div>

                <!-- Nagad Form -->
                <div class="withdraw-form" id="nagad-form">
                    <div class="form-group">
                        <label for="nagad-number">Nagad Number</label>
                        <input type="text" id="nagad-number" placeholder="01XXXXXXXXX">
                    </div>
                    <div class="form-group">
                        <label for="nagad-amount">Amount (৳)</label>
                        <input type="number" id="nagad-amount" placeholder="500" min="500">
                    </div>
                    <button class="submit-btn" id="nagad-submit">Withdraw</button>
                </div>

                <!-- Binance Form -->
                <div class="withdraw-form" id="binance-form">
                    <div class="form-group">
                        <label for="binance-uid">Binance UID</label>
                        <input type="text" id="binance-uid" placeholder="Enter your UID">
                    </div>
                    <div class="form-group">
                        <label for="binance-amount">Amount ($)</label>
                        <input type="number" id="binance-amount" placeholder="5" min="5" step="0.01">
                    </div>
                    <div class="rate-info">
                        <p>Current rate: 1 USD = 125৳</p>
                        <p id="conversion-display">$5 = 625৳</p>
                    </div>
                    <button class="submit-btn" id="binance-submit">Withdraw</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Win Popup -->
    <div class="win-popup" id="win-popup">
        <i class="fas fa-trophy" style="font-size: 3rem; color: var(--accent);"></i>
        <h2>Congratulations!</h2>
        <div class="win-amount" id="win-amount">20৳</div>
        <p>You won <span id="win-text">20৳</span>!</p>
        <button class="close-popup" id="close-popup">Continue</button>
    </div>

    <!-- Error Popup -->
    <div class="error-popup" id="error-popup">
        <div class="error-icon">
            <i class="fas fa-exclamation-triangle"></i>
        </div>
        <div class="error-title">Withdraw Failed</div>
        <div class="error-message" id="error-message">
            You need at least 6 referrals to withdraw 500৳. Multiple referrals from the same person won't count.
        </div>
        <button class="close-error" id="close-error">OK</button>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <!-- Ad Script -->
    <script data-project-id="3957">
      !function(){
        var s=document.currentScript,p=s.getAttribute('data-project-id')||'default';
        var d=['https://ad.gigapub.tech','https://ru-ad.gigapub.tech'],i=0,t,sc;
        function l(){
          sc=document.createElement('script');
          sc.async=true;
          sc.src=d[i]+'/script?id='+p;
          clearTimeout(t);
          t=setTimeout(function(){
            sc.onload=sc.onerror=null;
            sc.src='';
            if(++i<d.length)l();
          },15000);
          sc.onload=function(){clearTimeout(t)};
          sc.onerror=function(){clearTimeout(t);if(++i<d.length)l()};
          document.head.appendChild(sc);
        }
        l();
      }();
    </script>

    <script>
        // Game data
        const gameData = {
            balance: 0,
            referrals: 0,
            currentStage: 1,
            spinsLeft: 10,
            stages: [
                { spins: 10, amount: 10, total: 100 },
                { spins: 5, amount: 20, total: 100 },
                { spins: 3, amount: 20, total: 60 },
                { spins: 4, amount: 10, total: 40 },
                { spins: 1, amount: 50, total: 50 },
                { spins: 5, amount: 10, total: 50 },
                { spins: 25, amount: 2, total: 50 },
                { spins: 50, amount: 1, total: 50 }
            ],
            wheelSections: ['1৳', '2৳', '10৳', '20৳', '50৳', '100৳'],
            wheelColors: ['#FF5252', '#FF9800', '#FFEB3B', '#4CAF50', '#2196F3', '#9C27B0'],
            isSpinning: false,
            adInterval: null,
            referralId: generateReferralId()
        };

        // Generate a unique referral ID
        function generateReferralId() {
            // Try to get existing ID from localStorage
            let id = localStorage.getItem('referralId');
            if (id) return id;
            
            // Generate new ID if not exists
            id = 'SPIN' + Math.floor(10000 + Math.random() * 90000);
            localStorage.setItem('referralId', id);
            return id;
        }

        // Load game data from localStorage
        function loadGameData() {
            const savedData = localStorage.getItem('gameData');
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                gameData.balance = parsedData.balance || 0;
                gameData.referrals = parsedData.referrals || 0;
                gameData.currentStage = parsedData.currentStage || 1;
                gameData.spinsLeft = parsedData.spinsLeft || 10;
            }
        }

        // Save game data to localStorage
        function saveGameData() {
            localStorage.setItem('gameData', JSON.stringify({
                balance: gameData.balance,
                referrals: gameData.referrals,
                currentStage: gameData.currentStage,
                spinsLeft: gameData.spinsLeft
            }));
        }

        // DOM Elements
        const balanceEl = document.getElementById('balance');
        const referralsEl = document.getElementById('referrals');
        const referralCountEl = document.getElementById('referral-count');
        const spinButton = document.getElementById('spin-button');
        const wheel = document.getElementById('wheel');
        const winPopup = document.getElementById('win-popup');
        const winAmount = document.getElementById('win-amount');
        const winText = document.getElementById('win-text');
        const closePopup = document.getElementById('close-popup');
        const errorPopup = document.getElementById('error-popup');
        const errorMessage = document.getElementById('error-message');
        const closeError = document.getElementById('close-error');
        const overlay = document.getElementById('overlay');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const copyBtn = document.getElementById('copy-btn');
        const referralLink = document.getElementById('referral-link');
        const referralIdEl = document.getElementById('referral-id');
        const withdrawOptions = document.querySelectorAll('.withdraw-option');
        const withdrawForms = document.querySelectorAll('.withdraw-form');
        const currentStageEl = document.getElementById('current-stage');
        const spinsLeftEl = document.getElementById('spins-left');
        const amountPerSpinEl = document.getElementById('amount-per-spin');
        const stageTotalEl = document.getElementById('stage-total');
        const binanceAmount = document.getElementById('binance-amount');
        const conversionDisplay = document.getElementById('conversion-display');

        // Initialize the wheel
        function initWheel() {
            wheel.innerHTML = '';
            const sectionAngle = 360 / gameData.wheelSections.length;
            
            gameData.wheelSections.forEach((section, index) => {
                const sectionEl = document.createElement('div');
                sectionEl.className = 'wheel-section';
                sectionEl.textContent = section;
                sectionEl.style.backgroundColor = gameData.wheelColors[index];
                sectionEl.style.transform = `rotate(${index * sectionAngle}deg)`;
                wheel.appendChild(sectionEl);
            });
        }

        // Spin the wheel
        function spinWheel() {
            if (gameData.isSpinning) return;
            
            // Show ad before spinning
            if (window.showGiga) {
                window.showGiga()
                    .then(() => {
                        // Ad completed successfully, proceed with spin
                        performSpin();
                    })
                    .catch(e => {
                        // Ad failed, still allow spin for demo purposes
                        console.log("Ad failed:", e);
                        performSpin();
                    });
            } else {
                // Ad SDK not loaded, proceed with spin
                performSpin();
            }
        }

        // Perform the actual spin
        function performSpin() {
            gameData.isSpinning = true;
            spinButton.disabled = true;
            
            // Get current stage amount
            const currentAmount = gameData.stages[gameData.currentStage - 1].amount;
            
            // Find index of current amount in wheel sections
            let resultIndex = gameData.wheelSections.findIndex(section => section === `${currentAmount}৳`);
            
            // If current amount not found in wheel sections, default to first section
            if (resultIndex === -1) {
                resultIndex = 0;
            }
            
            // Calculate rotation (multiple full rotations + offset to land on result)
            const sectionAngle = 360 / gameData.wheelSections.length;
            const extraRotation = 5 * 360; // 5 full rotations
            const resultRotation = extraRotation + (360 - (resultIndex * sectionAngle) - sectionAngle/2);
            
            wheel.style.transform = `rotate(${resultRotation}deg)`;
            
            // After spin completes
            setTimeout(() => {
                const amountWon = currentAmount;
                gameData.balance += amountWon;
                updateUI();
                saveGameData();
                
                // Show win popup
                winAmount.textContent = `${amountWon}৳`;
                winText.textContent = `${amountWon}৳`;
                winPopup.style.display = 'block';
                overlay.style.display = 'block';
                
                // Update spins left and stage
                gameData.spinsLeft--;
                
                if (gameData.spinsLeft <= 0) {
                    if (gameData.currentStage < gameData.stages.length) {
                        gameData.currentStage++;
                        gameData.spinsLeft = gameData.stages[gameData.currentStage - 1].spins;
                    } else {
                        // Reset to stage 1 after completing all stages
                        gameData.currentStage = 1;
                        gameData.spinsLeft = gameData.stages[0].spins;
                    }
                }
                
                updateStageInfo();
                saveGameData();
                
                // Reset spinning state
                setTimeout(() => {
                    gameData.isSpinning = false;
                    spinButton.disabled = false;
                }, 2000);
            }, 4000);
        }

        // Update UI with current game data
        function updateUI() {
            balanceEl.textContent = `${gameData.balance}৳`;
            referralsEl.textContent = gameData.referrals;
            referralCountEl.textContent = gameData.referrals;
            referralIdEl.textContent = gameData.referralId;
            referralLink.value = `http://t.me/money_crash0_bot?start=${gameData.referralId}`;
        }

        // Update stage information
        function updateStageInfo() {
            const currentStage = gameData.stages[gameData.currentStage - 1];
            currentStageEl.textContent = gameData.currentStage;
            spinsLeftEl.textContent = gameData.spinsLeft;
            amountPerSpinEl.textContent = `${currentStage.amount}৳`;
            stageTotalEl.textContent = `${currentStage.total}৳`;
        }

        // Update conversion display
        function updateConversion() {
            const amount = parseFloat(binanceAmount.value) || 5;
            const converted = amount * 125;
            conversionDisplay.textContent = `$${amount} = ${converted}৳`;
        }

        // Initialize the app
        function initApp() {
            // Load saved data
            loadGameData();
            
            // Initialize UI
            initWheel();
            updateUI();
            updateStageInfo();
            
            // Set up event listeners
            spinButton.addEventListener('click', spinWheel);
            
            closePopup.addEventListener('click', () => {
                winPopup.style.display = 'none';
                overlay.style.display = 'none';
            });
            
            closeError.addEventListener('click', () => {
                errorPopup.style.display = 'none';
                overlay.style.display = 'none';
            });
            
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Copy referral link
            copyBtn.addEventListener('click', () => {
                referralLink.select();
                document.execCommand('copy');
                alert('Referral link copied to clipboard!');
            });
            
            // Withdraw option selection
            withdrawOptions.forEach(option => {
                option.addEventListener('click', () => {
                    const optionType = option.getAttribute('data-option');
                    
                    withdrawOptions.forEach(opt => opt.classList.remove('active'));
                    withdrawForms.forEach(form => form.style.display = 'none');
                    
                    option.classList.add('active');
                    document.getElementById(`${optionType}-form`).style.display = 'block';
                });
            });
            
            // Withdraw form submissions
            document.getElementById('bkash-submit').addEventListener('click', handleWithdraw);
            document.getElementById('nagad-submit').addEventListener('click', handleWithdraw);
            document.getElementById('binance-submit').addEventListener('click', handleWithdraw);
            
            // Binance amount conversion
            binanceAmount.addEventListener('input', updateConversion);
            
            // Initialize conversion display
            updateConversion();
        }

        // Handle withdraw attempts
        function handleWithdraw(e) {
            e.preventDefault();
            
            if (gameData.balance < 500) {
                showError('You need at least 500৳ balance to withdraw.');
                return;
            }
            
            if (gameData.referrals < 6) {
                showError('You need at least 6 referrals to withdraw 500৳. Multiple referrals from the same person won\'t count.');
                return;
            }
            
            // If conditions are met, show success message
            alert('Withdrawal request submitted successfully! It will be processed within 24 hours.');
        }

        // Show error popup
        function showError(message) {
            errorMessage.textContent = message;
            errorPopup.style.display = 'block';
            overlay.style.display = 'block';
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
